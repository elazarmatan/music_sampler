# סיקוונסר מוזיקה

אפליקציית סיקוונסר מוזיקה מבוססת אינטרנט המאפשרת למשתמשים ליצור, להשמיע ולשמור תבניות מוזיקליות באמצעות ערוצי כלי נגינה שונים.

## תכונות

- **ערוצי כלי נגינה מרובים**: מעבר בין פסנתר (🎹), גיטרה (🎸) ודרבוקה (🪘)
- **סיקוונסר גריד ויזואלי**: ממשק גריד אינטראקטיבי ליצירת תבניות מוזיקליות
- **בקרות השמעה**: הפעלה, השהיה, עצירה ושליטה במהירות ההשמעה
- **עמודות דינמיות**: הוספה או הסרה של עמודות (עד 100) לרצפים ארוכים יותר
- **בקרת עוצמת קול**: עוצמת קול הניתנת להתאמה עם משוב בזמן אמת
- **שמירה וטעינה**: שמירת היצירות המוזיקליות שלך וטעינה שלהן מאוחר יותר
- **אחסון בענן**: כל התבניות המוזיקליות וקבצי האודיו נשמרים ב-AWS S3
- **שמירה במטמון מקומי**: ערוצי כלי הנגינה נשמרים במטמון מקומי למשך שעה לשיפור ביצועים

## סטאק טכנולוגי

### Frontend
- **React 18** עם TypeScript
- **React Router** לניווט
- **Tone.js** להשמעת אודיו וסינתזה
- **Vite** ככלי בנייה
- Context API לניהול מצב

### Backend
- **Express.js** (v5.1.0)
- **AWS SDK v3** לאינטגרציה עם S3
- **CORS** מופעל לבקשות cross-origin
- **dotenv** לתצורת סביבה

### אחסון
- **AWS S3** לאחסון קבצי אודיו ותבניות שנוצרו על ידי משתמשים
- URLs חתומים מראש לגישה מאובטחת לאודיו (תפוגה של שעה)
- LocalStorage לשמירה במטמון בצד הלקוח

## מבנה הפרויקט

```
├── client/
│   ├── src/
│   │   ├── components/
│   │   │   ├── AudioSquare.tsx       # קומפוננטת תא בודד בגריד
│   │   │   ├── Music.tsx             # תצוגת פריט מוזיקה שמור
│   │   │   ├── buttons/              # כפתורי בקרה
│   │   │   │   ├── AddColumn.tsx
│   │   │   │   ├── Channels.tsx
│   │   │   │   ├── ControlSpeed.tsx
│   │   │   │   ├── Play.tsx
│   │   │   │   ├── Restart.tsx
│   │   │   │   ├── SaveState.tsx
│   │   │   │   ├── Stop.tsx
│   │   │   │   └── Volume.tsx
│   │   │   └── layout/
│   │   │       ├── GridMusic.tsx     # גריד הסיקוונסר הראשי
│   │   │       ├── InlineHeader.tsx
│   │   │       └── NavBar.tsx
│   │   ├── context/
│   │   │   └── MyContext.context.tsx # ניהול מצב גלובלי
│   │   ├── pages/
│   │   │   ├── HomePage.tsx
│   │   │   └── MusicSaves.tsx
│   │   ├── utils/
│   │   │   ├── getAllMusicSaved.ts
│   │   │   ├── getChanFromLocal.ts   # עוזרי LocalStorage
│   │   │   ├── getChannelFromServer.ts
│   │   │   ├── parseFileKey.ts
│   │   │   ├── playColumn.ts
│   │   │   ├── saveState.ts
│   │   │   ├── setColorAfter.ts
│   │   │   └── handles/
│   │   │       └── channels.ts
│   │   └── style/                     # קבצי CSS
│   └── App.tsx
│
└── server/
    ├── db/
    │   └── connectToS3.js            # אינטגרציה עם AWS S3
    ├── routes/
    │   ├── get.js                    # נקודות קצה GET
    │   └── post.js                   # נקודות קצה POST
    └── index.js                      # נקודת כניסה לשרת
```

## נקודות קצה API

### מסלולי GET

#### `/music/channel/:channame`
מביא קבצי אודיו לערוץ כלי נגינה ספציפי מ-S3.
- **פרמטרים**: `channame` (piano, guitar, או darbuka)
- **מחזיר**: JSON עם URLs חתומים מראש לקבצי אודיו
- **שמירה במטמון**: התוצאות נשמרות במטמון ב-localStorage למשך שעה

#### `/music/musicsaves`
מחזיר את כל התבניות המוזיקליות השמורות.
- **מחזיר**: מערך של אובייקטי מוזיקה שמורים עם מצב הגריד ומטה-דאטה

### מסלולי POST

#### `/create/saveState/:nameFile`
שומר תבנית מוזיקלית ל-S3.
- **פרמטרים**: `nameFile` - שם לתבנית השמורה
- **Body**: JSON המכיל `channel` ו-`matrix` (מצב הגריד)
- **מחזיר**: הודעת הצלחה

## הוראות התקנה

### דרישות מוקדמות
- Node.js (גרסה 18 ומעלה)
- חשבון AWS עם bucket S3 מוגדר
- אישורי AWS עם הרשאות קריאה/כתיבה ל-S3

### משתני סביבה

צור קובץ `.env` בתיקייה `server/`:

```env
PORT=3005
ENDPOINTS3=your_s3_endpoint
AceesKeyId=your_aws_access_key
SecretKey=your_aws_secret_key
```

### התקנה

1. **התקן תלויות השרת:**
```bash
cd server
npm install
```

2. **התקן תלויות הלקוח:**
```bash
cd client
npm install
```

### הפעלת האפליקציה

1. **הפעל את שרת ה-backend:**
```bash
cd server
npm run dev
```
השרת רץ על `http://localhost:3005`

2. **הפעל את שרת הפיתוח של ה-frontend:**
```bash
cd client
npm run dev
```
הלקוח בדרך כלל רץ על `http://localhost:5173`

## כיצד להשתמש

1. **בחר כלי נגינה**: לחץ על כפתור הערוץ (🎹/🎸/🪘) כדי לעבור בין כלי הנגינה
2. **צור תבנית**: לחץ על תאי הגריד כדי להפעיל/לכבות צלילים (לבן = פעיל, גרדיאנט = לא פעיל)
3. **התאם את הגריד**: השתמש בכפתורים +/- כדי להוסיף או להסיר עמודות
4. **שלוט בהשמעה**:
   - ▶ כדי להשמיע
   - ⏸ כדי להשהות
   - ⏹ כדי לעצור ולאפס
   - התאם את המהירות עם המחוון (x0.5 עד x5)
5. **שמור תבנית**: לחץ על "Save", הזן שם, ושלח
6. **טען תבנית**: נווט אל "MUSIC SAVE" כדי לראות ולטעון תבניות שמורות

## תכונות מרכזיות - הסבר

### מערכת הגריד
- כל עמודה מייצגת צעד זמן ברצף
- כל שורה מייצגת צליל/סאונד שונה בכלי הנגינה
- השורה התחתונה (🥁) מודגשת במיוחד
- העמודה הפעילה במהלך ההשמעה מוצגת עם אטימות מופחתת

### מערכת ההשמעה
- משתמשת ב-Tone.js לסינתזה והשמעת אודיו
- לולאה רצופה כאשר משמיעים
- תומכת בהתאמת מהירות מ-0.5x עד 5x
- בקרת העוצמה משפיעה על כל פלט האודיו

### ניהול מצב
- React Context API מנהל את המצב הגלובלי
- כולל: מצב הגריד, בקרות השמעה, כלי נגינה נבחר, עוצמת קול וכו'
- המצב נשמר במהלך הניווט בין דפים

### אסטרטגיית שמירה במטמון
- URLs של אודיו של כלי נגינה נשמרים במטמון ב-localStorage למשך שעה
- מפחית בקשות שרת ומשפר זמני טעינה
- המטמון מתבטל אוטומטית לאחר תפוגה

## מבנה ה-Bucket של S3

```
music/
├── piano/               # קבצי אודיו של פסנתר
├── guitar/              # קבצי אודיו של גיטרה
├── darbuka/             # קבצי אודיו של דרבוקה
└── createMusic/         # תבניות שנשמרו על ידי משתמשים
    └── [filename][timestamp].json
```

## אופטימיזציות ביצועים

- שמירה במטמון של LocalStorage לערוצי כלי נגינה (TTL של שעה)
- URLs חתומים מראש עם תפוגה של שעה
- טעינה עצלנית של תבניות מוזיקה שמורות
- השמעת אודיו עם debounce
- עדכוני מצב גריד יעילים באמצעות setState פונקציונלי

## תאימות דפדפנים

- דפדפנים מודרניים עם תמיכה ב-Web Audio API
- Chrome, Firefox, Safari, Edge (גרסאות אחרונות)
- דפדפני מובייל נתמכים

## מגבלות ידועות

- מקסימום 100 עמודות לכל רצף
- מינימום 10 עמודות לכל רצף
- קבצי אודיו חייבים להיות מאוחסנים ב-S3
- דורש חיבור אינטרנט יציב להזרמת אודיו

## שיפורים עתידיים

- [ ] הוספת ערוצי כלי נגינה נוספים
- [ ] תמיכה בהעלאת קבצי אודיו מותאמים אישית
- [ ] ייצוא תבניות כקבצי MIDI או אודיו
- [ ] תכונות עריכה שיתופיות
- [ ] ממשק מותאם למובייל
- [ ] שיתוף תבניות באמצעות קישורים
- [ ] אינדיקטור טמפו/BPM
- [ ] פונקציונליות ביטול/שחזור

## רישיון

ISC

## יוצרים

נוצר עם React, Express ו-Tone.js
